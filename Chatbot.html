<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Harvest Hacker - Chatbot</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #a8edea, #fed6e3);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .chat-container {
      background: #ffffffcc;
      width: 100%;
      max-width: 420px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: fadeIn 0.8s ease;
    }
    .chat-header {
      background: #27ae60;
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: bold;
    }
    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      max-height: 350px;
      scroll-behavior: smooth;
    }
    .message {
      margin: 10px 0;
      padding: 10px 15px;
      border-radius: 18px;
      width: fit-content;
      max-width: 80%;
      word-wrap: break-word;
      opacity: 0;
      transform: translateY(20px);
      animation: slideIn 0.4s forwards;
    }
    .user-message {
      background: #d1f7d1;
      align-self: flex-end;
    }
    .bot-message {
      background: #f1f1f1;
      align-self: flex-start;
    }
    .chat-input {
      display: flex;
      flex-direction: column;
      padding: 10px;
      border-top: 1px solid #ccc;
    }
    .chat-input input, .chat-input select, .chat-input button {
      margin: 5px 0;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .chat-input button {
      background: #27ae60;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .chat-input button:hover {
      background: #219150;
    }
    .mic-btn {
      background: #ff7675;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      margin-top: 5px;
      transition: background 0.3s ease;
    }
    .mic-btn.recording {
      background: #d63031;
      animation: pulse 1s infinite;
    }
    .cam-btn {
      background: #0984e3;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      margin-top: 5px;
      transition: background 0.3s ease;
    }
    .cam-btn:hover {
      background: #0769a5;
    }
    .chat-messages img, 
    .chat-messages video, 
    .chat-messages audio {
      border-radius: 10px;
      margin-top: 5px;
      max-width: 100%;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes slideIn {
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(214,48,49, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(214,48,49, 0); }
      100% { box-shadow: 0 0 0 0 rgba(214,48,49, 0); }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">Farm Helper Chatbot</div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="ur">ÿßÿ±ÿØŸà</option>
        <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
      </select>
      <input type="text" id="userInput" placeholder="Type your problem..." />
      <input type="file" id="mediaInput" accept="image/,video/,audio/*" />
      <button onclick="sendMessage()">Send</button>
      <button class="mic-btn" id="micBtn" onclick="toggleRecording()">üé§</button>
      <button class="cam-btn" id="camBtn" onclick="openCamera()">üì∑</button>
    </div>
  </div>

  <script>
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const mediaInput = document.getElementById('mediaInput');
    const languageSelect = document.getElementById('languageSelect');
    const micBtn = document.getElementById('micBtn');

    let mediaRecorder;
    let audioChunks = [];
    let cameraStream;

    const translations = {
      en: {
        water: "Make sure your irrigation system is working properly. Try drip irrigation.",
        fertilizer: "Use recommended fertilizers based on soil tests.",
        pest: "Use neem oil or organic methods for pest control.",
        default: "Please explain your problem in detail or contact the agriculture office."
      },
      hi: {
        water: "‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§∏‡§π‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§°‡•ç‡§∞‡§ø‡§™ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Å‡•§",
        fertilizer: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
        pest: "‡§ï‡•Ä‡§ü ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§Æ ‡§ï‡§æ ‡§§‡•á‡§≤ ‡§Ø‡§æ ‡§ú‡•à‡§µ‡§ø‡§ï ‡§µ‡§ø‡§ß‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
        default: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§Ç ‡§Ø‡§æ ‡§ï‡•É‡§∑‡§ø ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§"
      },
      ur: {
        water: "€åŸÇ€åŸÜ€å ÿ®ŸÜÿßÿ¶€å⁄∫ ⁄©€Å ÿ¢Ÿæ ⁄©ÿß ÿ¢ÿ®Ÿæÿßÿ¥€å ŸÜÿ∏ÿßŸÖ ÿØÿ±ÿ≥ÿ™ ⁄©ÿßŸÖ ⁄©ÿ± ÿ±€Åÿß €Å€í€î ⁄àÿ±Ÿæ ÿ¢ÿ®Ÿæÿßÿ¥€å ÿ¢ÿ≤ŸÖÿßÿ¶€å⁄∫€î",
        fertilizer: "ŸÖŸπ€å ⁄©€í ÿ™ÿ¨ÿ≤€å€í ⁄©€å ÿ®ŸÜ€åÿßÿØ Ÿæÿ± ÿ™ÿ¨Ÿà€åÿ≤ ⁄©ÿ±ÿØ€Å ⁄©⁄æÿßÿØ ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ⁄©ÿ±€å⁄∫€î",
        pest: "⁄©€å⁄ëŸà⁄∫ ⁄©€í ⁄©ŸÜŸπÿ±ŸàŸÑ ⁄©€í ŸÑ€å€í ŸÜ€åŸÖ ⁄©ÿß ÿ™€åŸÑ €åÿß ŸÇÿØÿ±ÿ™€å ÿ∑ÿ±€åŸÇ€í ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ⁄©ÿ±€å⁄∫€î",
        default: "ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿßŸæŸÜ€å ŸÖÿ≥ÿ¶ŸÑ€Å ÿ™ŸÅÿµ€åŸÑ ÿ≥€í ÿ®€åÿßŸÜ ⁄©ÿ±€å⁄∫ €åÿß ÿ≤ÿ±ÿπ€å ÿØŸÅÿ™ÿ± ÿ≥€í ÿ±ÿßÿ®ÿ∑€Å ⁄©ÿ±€å⁄∫€î"
      },
      pa: {
        water: "‡®Ø‡®ï‡©Ä‡®®‡©Ä ‡®¨‡®£‡®æ‡®ì ‡®ï‡®ø ‡®§‡©Å‡®π‡®æ‡®°‡©Ä ‡®∏‡®ø‡©∞‡®ö‡®æ‡®à ‡®™‡©ç‡®∞‡®£‡®æ‡®≤‡©Ä ‡®∏‡®π‡©Ä ‡®ï‡©∞‡®Æ ‡®ï‡®∞ ‡®∞‡®π‡©Ä ‡®π‡©à‡•§ ‡®°‡®∞‡®ø‡®™ ‡®∏‡®ø‡©∞‡®ö‡®æ‡®à ‡®Ö‡®ú‡®º‡®Æ‡®æ‡®ì‡•§",
        fertilizer: "‡®Æ‡®ø‡©±‡®ü‡©Ä ‡®ú‡®æ‡®Ç‡®ö ‡®¶‡©á ‡®Ü‡®ß‡®æ‡®∞ '‡®§‡©á ‡®∏‡®ø‡®´‡®º‡®æ‡®∞‡®∏‡®º ‡®ï‡©Ä‡®§‡©á ‡®ñ‡®æ‡®¶‡®æ‡®Ç ‡®¶‡©Ä ‡®µ‡®∞‡®§‡©ã‡®Ç ‡®ï‡®∞‡©ã‡•§",
        pest: "‡®ï‡©Ä‡©ú‡®ø‡®Ü‡®Ç ‡®¶‡©á ‡®®‡®ø‡®Ø‡©∞‡®§‡®∞‡®£ ‡®≤‡®à ‡®®‡©Ä‡®Æ ‡®¶‡©á ‡®§‡©á‡®≤ ‡®ú‡®æ‡®Ç ‡®ú‡©à‡®µ‡®ø‡®ï ‡®§‡®∞‡©Ä‡®ï‡©á ‡®µ‡®∞‡®§‡©ã‡•§",
        default: "‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®Ü‡®™‡®£‡©Ä ‡®∏‡®Æ‡©±‡®∏‡®ø‡®Ü ‡®µ‡®ø‡®∏‡®•‡®æ‡®∞ ‡®®‡®æ‡®≤ ‡®¶‡©±‡®∏‡©ã ‡®ú‡®æ‡®Ç ‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®¶‡®´‡®º‡®§‡®∞ ‡®®‡®æ‡®≤ ‡®∏‡©∞‡®™‡®∞‡®ï ‡®ï‡®∞‡©ã‡•§"
      }
    };

    function sendMessage() {
      const message = userInput.value.trim();
      const file = mediaInput.files[0];
      const lang = languageSelect.value;

      if (message === "" && !file) {
        alert("Please enter a message or upload a file.");
        return;
      }

      if (message !== "") {
        addMessage(message, "user-message");
      }

      if (file) {
        const fileType = file.type.split('/')[0];
        let mediaElement;

        if (fileType === "image") {
          mediaElement = document.createElement("img");
          mediaElement.src = URL.createObjectURL(file);
          addMessage(mediaElement, "user-message");

          setTimeout(() => {
            addMessage(translations[lang].default, "bot-message");
          }, 500);
          return;
        } 
        else if (fileType === "video") {
          mediaElement = document.createElement("video");
          mediaElement.src = URL.createObjectURL(file);
          mediaElement.controls = true;
          addMessage(mediaElement, "user-message");

          setTimeout(() => {
            addMessage(translations[lang].default, "bot-message");
          }, 500);
          return;
        }
        else if (fileType === "audio") {
          mediaElement = document.createElement("audio");
          mediaElement.src = URL.createObjectURL(file);
          mediaElement.controls = true;
          addMessage(mediaElement, "user-message");

          setTimeout(() => {
            addMessage(translations[lang].default, "bot-message");
          }, 500);
          return;
        }
      }

      userInput.value = "";
      mediaInput.value = "";

      setTimeout(() => {
        const response = getBotResponse(message, lang);
        addMessage(response, "bot-message");
      }, 500);
    }

    function addMessage(textOrElement, className) {
      const msgDiv = document.createElement('div');
      msgDiv.className = "message " + className;
      if (typeof textOrElement === "string") {
        msgDiv.innerText = textOrElement;
      } else {
        msgDiv.appendChild(textOrElement);
      }
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getBotResponse(message, lang) {
      message = message.toLowerCase();
      const dict = translations[lang];
      for (const keyword in dict) {
        if (keyword !== "default" && message.includes(keyword)) {
          return dict[keyword];
        }
      }
      return dict.default;
    }

    async function toggleRecording() {
      if (!mediaRecorder || mediaRecorder.state === "inactive") {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          micBtn.classList.add("recording");
          audioChunks = [];

          mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
            const audioUrl = URL.createObjectURL(audioBlob);

            const audioElement = document.createElement("audio");
            audioElement.src = audioUrl;
            audioElement.controls = true;

            addMessage(audioElement, "user-message");

            setTimeout(() => {
              addMessage(translations[languageSelect.value].default, "bot-message");
            }, 500);
          };
        } catch (err) {
          alert("Mic access denied!");
        }
      } else {
        mediaRecorder.stop();
        micBtn.classList.remove("recording");
      }
    }

    function openCamera() {
      const video = document.createElement("video");
      video.autoplay = true;
      video.style.width = "100%";
      video.style.borderRadius = "10px";

      const captureBtn = document.createElement("button");
      captureBtn.innerText = "üì∏ Capture";
      captureBtn.style.marginTop = "10px";
      captureBtn.style.padding = "8px 12px";
      captureBtn.style.border = "none";
      captureBtn.style.background = "#27ae60";
      captureBtn.style.color = "white";
      captureBtn.style.borderRadius = "8px";
      captureBtn.style.cursor = "pointer";

      const previewDiv = document.createElement("div");
      previewDiv.style.position = "fixed";
      previewDiv.style.top = "50%";
      previewDiv.style.left = "50%";
      previewDiv.style.transform = "translate(-50%, -50%)";
      previewDiv.style.background = "white";
      previewDiv.style.padding = "15px";
      previewDiv.style.borderRadius = "12px";
      previewDiv.style.boxShadow = "0 8px 20px rgba(0,0,0,0.3)";
      previewDiv.style.zIndex = "1000";
      previewDiv.appendChild(video);
      previewDiv.appendChild(captureBtn);

      document.body.appendChild(previewDiv);

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          cameraStream = stream;
          video.srcObject = stream;
        })
        .catch(err => {
          alert("Camera access denied!");
          document.body.removeChild(previewDiv);
        });

      captureBtn.onclick = () => {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const img = document.createElement("img");
        img.src = canvas.toDataURL("image/png");
        img.style.maxWidth = "100%";
        img.style.borderRadius = "10px";

        addMessage(img, "user-message");

        setTimeout(() => {
          addMessage(translations[languageSelect.value].default, "bot-message");
        }, 500);

        cameraStream.getTracks().forEach(track => track.stop());
        document.body.removeChild(previewDiv);
      };
    }

    userInput.addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
  </script>
</body>
</html>